# Variable pressure advance tests
DICTIONARY out/klipper.dict
CONFIG variable_pressure_advance.cfg

# Test basic variable pressure advance
SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=extruder RATE_MIN=1.0 RATE_MAX=8.0 PA_MIN=0.02 PA_MAX=0.15 POWER=1.5
# Home and extrusion moves
G28
G1 X20 Y20 Z1 F6000
G1 E7
G1 X25 Y25 E7.5

# Test calibration routine
CALIBRATE_PRESSURE_ADVANCE EXTRUDER=extruder START_RATE=1.5 END_RATE=6.0 STEPS=3 START_PA=0.01 END_PA=0.08 DISTANCE=20

# Test setting different parameters
SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=extruder RATE_MIN=0.5 RATE_MAX=10.0 PA_MIN=0.01 PA_MAX=0.20 POWER=2.0
G1 X30 Y30 E8.0

# Test with extra stepper
SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=my_extra_stepper RATE_MIN=2.0 RATE_MAX=12.0 PA_MIN=0.03 PA_MAX=0.25 POWER=1.0
G1 X35 Y35 E8.5

# Test non-linear power factors
SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=extruder RATE_MIN=1.0 RATE_MAX=5.0 PA_MIN=0.05 PA_MAX=0.10 POWER=0.5
G1 X40 Y40 E9.0

# Test with smoothing
SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=extruder RATE_MIN=1.0 RATE_MAX=8.0 PA_MIN=0.02 PA_MAX=0.15 POWER=1.5 SMOOTH_TIME=0.02
G1 X45 Y45 E9.5