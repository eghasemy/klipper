# Example extruder configuration with enhanced pressure advance
# This shows how to configure variable pressure advance for optimal printing
# across different extrusion rates and speeds

[extruder]
step_pin: PA4
dir_pin: PA6  
enable_pin: !PA2
microsteps: 16
rotation_distance: 33.5
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PB4
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PK5
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 250

# Enhanced Pressure Advance Configuration
# Option 1: Traditional pressure advance (existing method)
# pressure_advance: 0.05
# pressure_advance_smooth_time: 0.040

# Option 2: Variable pressure advance (recommended for better quality)
pressure_advance_variable: True
pressure_advance_rate_min: 1.0          # Minimum extrusion rate (mm/s)
pressure_advance_rate_max: 8.0          # Maximum extrusion rate (mm/s)
pressure_advance_value_min: 0.02        # PA value at minimum rate
pressure_advance_value_max: 0.12        # PA value at maximum rate  
pressure_advance_rate_power: 1.3        # Non-linear interpolation factor
pressure_advance_smooth_time: 0.040     # Smoothing time

# How to use:
# 1. Start with traditional PA calibration to find good baseline values
# 2. Use those values as your min/max range
# 3. Adjust the power factor for your material:
#    - 1.0 = linear response
#    - >1.0 = more aggressive at higher speeds (good for flexible materials)
#    - <1.0 = more conservative at higher speeds (good for stiff materials)
# 4. Use CALIBRATE_PRESSURE_ADVANCE to fine-tune automatically

# Runtime commands for tuning:
# SET_VARIABLE_PRESSURE_ADVANCE EXTRUDER=extruder RATE_MIN=1.0 RATE_MAX=8.0 PA_MIN=0.02 PA_MAX=0.12 POWER=1.3
# CALIBRATE_PRESSURE_ADVANCE EXTRUDER=extruder START_RATE=2.0 END_RATE=10.0 STEPS=5 START_PA=0.02 END_PA=0.15