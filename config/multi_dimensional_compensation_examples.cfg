# Multi-Dimensional Resonance Compensation Configuration Examples
#
# This file contains example configurations for different printer types and use cases

# ==============================================================================
# BASIC CONFIGURATION - Start Here
# ==============================================================================

[adaptive_input_shaper]
# Enable the adaptive compensation system
enabled: True

# Spatial resolution - minimum distance between calibration points (mm)
# Lower values = more calibration points = more accurate but longer calibration
spatial_resolution: 50.0

# Model resolution - number of speed and acceleration bins for analysis
# Higher values = more granular analysis but more memory usage
speed_bins: 5
accel_bins: 5

# Transition smoothing - how quickly parameters change (0.01-1.0)
# Lower values = faster transitions, higher values = smoother transitions
transition_smoothing: 0.1

[dynamic_input_shaper]
# Enable real-time parameter adaptation during printing
enabled: True

# Adaptation responsiveness (0.01-1.0)
# Higher values = more responsive to movement changes
adaptation_rate: 0.1

# Minimum time between parameter updates (seconds)
# Lower values = more frequent updates but higher CPU usage
min_update_interval: 0.5

# Motion analysis parameters
analysis_window: 2.0      # Time window for motion analysis (seconds)
update_interval: 0.1      # How often to analyze motion (seconds)

# ==============================================================================
# HIGH-PERFORMANCE CONFIGURATION - For Speed-Optimized Setups
# ==============================================================================

[adaptive_input_shaper high_performance]
enabled: True
spatial_resolution: 40.0    # Slightly higher resolution
speed_bins: 6               # More speed categories
accel_bins: 6               # More acceleration categories  
transition_smoothing: 0.05  # Faster parameter transitions

[dynamic_input_shaper high_performance]
enabled: True
adaptation_rate: 0.15       # More responsive adaptation
min_update_interval: 0.3    # Faster updates
analysis_window: 1.5        # Shorter analysis window for quicker response
update_interval: 0.05       # Higher update frequency

# ==============================================================================
# HIGH-PRECISION CONFIGURATION - For Quality-Focused Setups
# ==============================================================================

[adaptive_input_shaper high_precision]
enabled: True
spatial_resolution: 30.0    # Higher resolution mapping
speed_bins: 8               # Fine-grained speed analysis
accel_bins: 8               # Fine-grained acceleration analysis
transition_smoothing: 0.2   # Smoother transitions for stability

[dynamic_input_shaper high_precision]
enabled: True
adaptation_rate: 0.08       # More conservative adaptation
min_update_interval: 0.8    # Less frequent updates for stability
analysis_window: 3.0        # Longer analysis for better pattern recognition
update_interval: 0.1        # Standard update frequency

# ==============================================================================
# LARGE PRINTER CONFIGURATION - For Printers >300x300mm
# ==============================================================================

[adaptive_input_shaper large_printer]
enabled: True
spatial_resolution: 60.0    # Larger spacing for big beds
speed_bins: 6               # Account for speed variations
accel_bins: 6               # Account for acceleration variations
transition_smoothing: 0.15  # Moderate transition smoothing

[dynamic_input_shaper large_printer]
enabled: True
adaptation_rate: 0.12       # Moderate adaptation rate
min_update_interval: 0.4    # Account for longer travel times
analysis_window: 2.5        # Longer analysis for large movements
update_interval: 0.08       # Slightly higher update frequency

# ==============================================================================
# SMALL/DESKTOP PRINTER CONFIGURATION - For Printers <200x200mm
# ==============================================================================

[adaptive_input_shaper desktop]
enabled: True
spatial_resolution: 40.0    # Higher resolution for small beds
speed_bins: 4               # Fewer bins for simpler analysis
accel_bins: 4               # Fewer bins for simpler analysis
transition_smoothing: 0.08  # Quick transitions for rapid movements

[dynamic_input_shaper desktop]
enabled: True
adaptation_rate: 0.2        # High responsiveness for quick moves
min_update_interval: 0.2    # Fast updates for rapid changes
analysis_window: 1.0        # Short analysis window
update_interval: 0.05       # High update frequency

# ==============================================================================
# COREXY CONFIGURATION - Optimized for CoreXY Kinematics
# ==============================================================================

[adaptive_input_shaper corexy]
enabled: True
spatial_resolution: 45.0    # Optimized for typical CoreXY bed sizes
speed_bins: 6               # Account for CoreXY speed characteristics
accel_bins: 7               # Higher acceleration capabilities
transition_smoothing: 0.1   # Standard smoothing

[dynamic_input_shaper corexy]
enabled: True
adaptation_rate: 0.12       # Moderate adaptation for coupled axes
min_update_interval: 0.4    # Account for cross-axis effects
analysis_window: 2.0        # Standard analysis window
update_interval: 0.08       # Good balance for CoreXY

# ==============================================================================
# DELTA PRINTER CONFIGURATION - Optimized for Delta Kinematics
# ==============================================================================

[adaptive_input_shaper delta]
enabled: True
spatial_resolution: 35.0    # Higher resolution due to complex kinematics
speed_bins: 7               # Account for varying arm positions
accel_bins: 6               # Delta-specific acceleration patterns
transition_smoothing: 0.15  # Smoother transitions for stability

[dynamic_input_shaper delta]
enabled: True
adaptation_rate: 0.1        # Conservative for complex kinematics
min_update_interval: 0.6    # Longer intervals for stability
analysis_window: 2.5        # Longer analysis for delta movements
update_interval: 0.1        # Standard update frequency

# ==============================================================================
# TROUBLESHOOTING/DEBUG CONFIGURATION - For Testing and Diagnosis
# ==============================================================================

[adaptive_input_shaper debug]
enabled: True
spatial_resolution: 80.0    # Fewer points for quick testing
speed_bins: 3               # Minimal bins for fast analysis
accel_bins: 3               # Minimal bins for fast analysis
transition_smoothing: 0.3   # Very smooth transitions for observation

[dynamic_input_shaper debug]
enabled: False              # Disable dynamic mode for baseline testing
adaptation_rate: 0.05       # Very conservative when enabled
min_update_interval: 2.0    # Slow updates for observation
analysis_window: 5.0        # Long analysis window
update_interval: 0.2        # Slow update frequency

# ==============================================================================
# MACROS FOR ADAPTIVE CALIBRATION
# ==============================================================================

[gcode_macro ADAPTIVE_CALIBRATION_BASIC]
description: Basic adaptive resonance calibration
gcode:
    # Ensure printer is ready
    {% if not printer.toolhead.homed_axes %}
        G28                    # Home if not already homed
    {% endif %}
    
    # Heat bed for realistic conditions
    {% if printer.heated_bed %}
        M190 S60              # Heat bed to 60C
    {% endif %}
    
    # Perform adaptive calibration
    ADAPTIVE_RESONANCE_CALIBRATE DENSITY=medium
    BUILD_COMPENSATION_MODEL
    
    # Enable adaptive shaping
    ENABLE_DYNAMIC_SHAPING ENABLE=1
    
    RESPOND MSG="Basic adaptive calibration complete!"

[gcode_macro ADAPTIVE_CALIBRATION_COMPREHENSIVE]
description: Comprehensive adaptive resonance calibration with pattern testing
gcode:
    # Ensure printer is ready
    {% if not printer.toolhead.homed_axes %}
        G28
    {% endif %}
    
    # Heat to printing conditions
    {% if printer.heated_bed %}
        M190 S65              # Slightly higher bed temp
    {% endif %}
    M109 S200                 # Heat nozzle for realistic mass
    
    # Perform comprehensive calibration
    ADAPTIVE_RESONANCE_CALIBRATE DENSITY=high TEST_PATTERNS=1
    BUILD_COMPENSATION_MODEL
    
    # Set base parameters from previous calibration
    {% if printer.configfile.settings.input_shaper %}
        SET_BASE_SHAPER_PARAMS SHAPER_TYPE_X={printer.configfile.settings.input_shaper.shaper_type_x} SHAPER_FREQ_X={printer.configfile.settings.input_shaper.shaper_freq_x} SHAPER_TYPE_Y={printer.configfile.settings.input_shaper.shaper_type_y} SHAPER_FREQ_Y={printer.configfile.settings.input_shaper.shaper_freq_y}
    {% endif %}
    
    # Enable adaptive shaping
    ENABLE_DYNAMIC_SHAPING ENABLE=1
    
    RESPOND MSG="Comprehensive adaptive calibration complete!"

[gcode_macro QUICK_ADAPTIVE_TEST]
description: Quick test of adaptive compensation at current position
gcode:
    {% set speed = params.SPEED|default(100)|float %}
    {% set accel = params.ACCEL|default(3000)|float %}
    
    APPLY_ADAPTIVE_SHAPING SPEED={speed} ACCEL={accel}
    GET_DYNAMIC_SHAPER_STATUS

[gcode_macro ADAPTIVE_SHAPING_ON]
description: Enable adaptive input shaping
gcode:
    ENABLE_DYNAMIC_SHAPING ENABLE=1
    RESPOND MSG="Adaptive input shaping enabled"

[gcode_macro ADAPTIVE_SHAPING_OFF]
description: Disable adaptive input shaping
gcode:
    ENABLE_DYNAMIC_SHAPING ENABLE=0
    RESPOND MSG="Adaptive input shaping disabled"

# ==============================================================================
# INTEGRATION WITH EXISTING SYSTEMS
# ==============================================================================

# Add to your existing [gcode_macro PRINT_START] or start G-code:
#
# [gcode_macro PRINT_START]
# gcode:
#     # ... your existing start code ...
#     
#     # Enable adaptive shaping if calibrated
#     {% if printer.adaptive_input_shaper %}
#         ADAPTIVE_SHAPING_ON
#     {% endif %}

# Add to your existing [gcode_macro PRINT_END] or end G-code:
#
# [gcode_macro PRINT_END]  
# gcode:
#     # ... your existing end code ...
#     
#     # Optional: Disable adaptive shaping after print
#     # ADAPTIVE_SHAPING_OFF

# ==============================================================================
# PERFORMANCE TUNING NOTES
# ==============================================================================

# CPU Usage Guidelines:
# - update_interval: 0.05 = ~2% CPU, 0.1 = ~1% CPU, 0.2 = ~0.5% CPU
# - Higher speed_bins/accel_bins increase memory usage (~1MB per bin)
# - Lower spatial_resolution increases calibration time linearly
#
# Recommended Settings by Printer Class:
# - Budget printers: Use "desktop" config, longer intervals
# - Mid-range printers: Use "basic" config
# - High-end printers: Use "high_performance" config
# - Very large printers: Use "large_printer" config with custom spatial_resolution
#
# Calibration Time Estimates:
# - spatial_resolution 80mm: 9 points, ~4.5 min
# - spatial_resolution 60mm: 16 points, ~8 min  
# - spatial_resolution 40mm: 25 points, ~12.5 min
# - spatial_resolution 30mm: 49 points, ~24.5 min

# ==============================================================================
# SAFETY CONSIDERATIONS
# ==============================================================================

# IMPORTANT: Always test with reduced speeds initially
# 1. Calibrate with 50% of normal speeds/accelerations
# 2. Gradually increase to full speeds over several prints
# 3. Monitor first prints closely for any unusual behavior
# 4. Keep traditional input shaper settings as backup
# 5. Disable adaptive mode if any print quality issues occur